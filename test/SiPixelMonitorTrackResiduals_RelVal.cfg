process SiPixelMonitorTrackResiduals = {
  include "FWCore/MessageLogger/data/MessageLogger.cfi"

  service = AdaptorConfig {}

  source = PoolSource {
    untracked vstring fileNames = {
      'rfio:/castor/cern.ch/cms/store/relvall/2008/5/4/RelVal-RelValTTbar-1209247429-IDEAL_V1-3rd/0000/221D7FC1-1D1A-DD11-8A8B-001617DBD288.root'
    }
    untracked uint32 debugVebosity = 10
    untracked bool debugFlag = true
  }
  untracked PSet maxEvents = { untracked int32 input = -1 }

  include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"
  # include "Geometry/TrackerRecoData/data/trackerRecoGeometryXML.cfi"
  # include "Geometry/TrackerSimData/data/trackerSimGeometryXML.cfi"
  include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cfi"
  include "Geometry/TrackerNumberingBuilder/data/trackerNumberingGeometry.cfi"
  ### include "Configuration/StandardSequences/data/FrontierConditions_GlobalTag.cff"
  include "Geometry/TrackerGeometryBuilder/data/trackerGeometry.cfi"
  include "Geometry/DTGeometry/data/dtGeometry.cfi"
  include "Geometry/CSCGeometry/data/cscGeometry.cfi"
  replace CSCGeometryESModule.applyAlignment = true  
  replace DTGeometryESModule.applyAlignment = true
  replace TrackerDigiGeometryESModule.applyAlignment = true

  include "CalibTracker/SiStripESProducers/data/SiStripPedestalsFakeSource.cfi"
  include "CalibTracker/SiStripESProducers/data/SiStripQualityFakeESSource.cfi"
  include "CalibTracker/SiStripESProducers/data/SiStripGainESProducer.cfi"
  # es_module sistripconn = SiStripConnectivity {}
  include "RecoLocalTracker/SiStripRecHitConverter/data/StripCPEfromTrackAngle.cfi"

  include "CalibCalorimetry/EcalLaserCorrection/data/ecalLaserCorrectionService.cfi"
  es_module hcal_db_producer = HcalDbProducer {
    untracked vstring dump = { "" } 
    untracked string file = ""
  }
  es_source es_hardcode = HcalHardcodeCalibrations { 
    untracked vstring toGet = { "GainWidths", "channelQuality", "ZSThresholds" } 
  }
  # include "CondCore/DBCommon/data/CondDBSetup.cfi"
  # es_source GlobalTag = PoolDBESSource {
  #   using CondDBSetup
  #   string connect = "frontier://FrontierProd/CMS_COND_20X_GLOBALTAG"
  #   untracked string globaltag = "CRUZET2_V1::All"
  #   untracked string BlobStreamerName = "TBufferBlobStreamingService"
  # }
  ### 
  include "CalibTracker/Configuration/data/TrackerAlignment/TrackerAlignment_Fake.cff"
  include "CalibTracker/Configuration/data/SiStrip_FakeConditions.cff"
  include "CalibTracker/Configuration/data/SiPixelGain/SiPixelGain_Fake.cff"
  include "CalibTracker/Configuration/data/SiPixelLorentzAngle/SiPixelLorentzAngle_Fake.cff"
    
  ### include "CondTools/SiPixel/data/SiPixelCalibConfiguration.cfi"
  include "CondCore/DBCommon/data/CondDBCommon.cfi"  
  es_source sipixelcalib_essource = PoolDBESSource {
    using CondDBCommon
    VPSet toGet = { 
      { string record = "SiPixelFedCablingMapRcd" string tag = "SiPixelFedCablingMap_v12" }, 
      { string record = "SiPixelGainCalibrationRcd" string tag = "V2_trivial_TBuffer_mc_pre7" }
    }
    untracked string BlobStreamerName = "TBufferBlobStreamingService"
  }
  replace sipixelcalib_essource.connect = "oracle://cms_orcoff_int2r/CMS_COND_TIF_PIXELS"
  replace sipixelcalib_essource.DBParameters.authenticationPath = "/afs/cern.ch/cms/DB/conddb"
  replace sipixelcalib_essource.DBParameters.messageLevel = 0
  ### 
  include "EventFilter/SiPixelRawToDigi/data/SiPixelRawToDigi.cfi"
  replace siPixelDigis.InputLabel = "rawDataCollector"
  replace siPixelDigis.IncludeErrors = true
  include "RecoLocalTracker/SiPixelClusterizer/data/SiPixelClusterizer.cfi"
  include "RecoLocalTracker/SiPixelRecHits/data/SiPixelRecHits.cfi"
  include "RecoLocalTracker/SiPixelRecHits/data/PixelCPEESProducers.cff"
  sequence siPixelLocalReco = { siPixelDigis, siPixelClusters, siPixelRecHits }
  
  include "EventFilter/SiStripRawToDigi/data/SiStripRawToDigis_standard.cff"
  replace siStripDigis.ProductLabel = "rawDataCollector"
  include "RecoLocalTracker/SiStripClusterizer/data/SiStripClusterizer.cfi"
  include "RecoLocalTracker/SiStripRecHitConverter/data/SiStripRecHitConverter.cfi"
  include "RecoLocalTracker/SiStripRecHitConverter/data/SiStripRecHitMatcher.cfi"
  include "RecoLocalTracker/SiStripRecHitConverter/data/StripCPEfromTrackAngle.cfi"
  include "RecoLocalTracker/SiStripZeroSuppression/data/SiStripZeroSuppression_SimData.cfi"
  sequence siStripLocalReco = { siStripDigis, siStripZeroSuppression, siStripClusters, siStripMatchedRecHits }
  
  sequence trackerLocalReco = { siPixelLocalReco, siStripLocalReco }

  include "RecoVertex/BeamSpotProducer/data/BeamSpot.cff"
  include "RecoPixelVertexing/Configuration/data/RecoPixelVertexing.cff"
  include "RecoTracker/Configuration/data/RecoTracker.cff"
  
  sequence trackReconstruction = { 
    trackerLocalReco, 
    offlineBeamSpot & recopixelvertexing, 
    ckftracks # & rstracks 
  }
  include "DQM/SiPixelMonitorRawData/data/SiPixelMonitorRawData.cfi"
  include "DQM/SiPixelMonitorDigi/data/SiPixelMonitorDigi.cfi"
  include "DQM/SiPixelMonitorCluster/data/SiPixelMonitorCluster.cfi"
  replace SiPixelClusterSource.outputFile = "/tmp/schuang/DQMcluster_test.root"
  include "DQM/SiPixelMonitorRecHit/data/SiPixelMonitorRecHit.cfi"
  replace SiPixelRecHitSource.outputFile = "/tmp/schuang/DQMrecHit_test.root"
  include "DQM/SiPixelMonitorTrack/data/SiPixelMonitorTrack.cfi"
  replace SiPixelTrackResidualSource.outputFilename = "/tmp/schuang/DQMtrackResidual_test.root"

  service = DQMStore { 
   untracked string referenceFileName = ""
   untracked int32 verbose = 0
  }
  service = LockService { 
    untracked vstring labels = { "source" } 
  }
  service = ModuleWebRegistry {}

  sequence monitors = {
    # SiPixelRawDataErrorSource, 
    # SiPixelDigiSource, 
    # SiPixelClusterSource, 
    # SiPixelRecHitSource, 
    SiPixelTrackResidualSource
  }
  path p = { 
    trackReconstruction, 
    monitors 
  }
}
